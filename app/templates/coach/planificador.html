{% extends "layout.html" %}
{% block title %}Planificador ‚Äî {{ atleta.nombre }}{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- HEADER -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="mb-1">üìÖ Planificador ‚Äî {{ atleta.nombre }}</h2>
      <div class="text-muted">Semana: <strong>{{ semana_str }}</strong></div>
    </div>

    <div class="d-flex gap-2">
      <form method="post"
            action="{{ url_for('main.coach_copiar_semana', user_id=atleta.id) }}"
            onsubmit="return confirm('¬øCopiar toda esta semana a la siguiente?');">
        <input type="hidden" name="center" value="{{ center.isoformat() }}">
        <button class="btn btn-outline-warning btn-sm">
          üìã Copiar semana ‚Üí siguiente
        </button>
      </form>

      <a class="btn btn-outline-light btn-sm"
         href="{{ url_for('main.dashboard_entrenador') }}">
        ‚Üê Dashboard
      </a>
    </div>
  </div>

  <!-- GRID SEMANAL -->
  <div class="row g-3">
    {% for f in fechas %}
      {% set plan = planes[f] %}
      <div class="col-md-6 col-lg-4">
        <div class="card bg-dark text-light border-secondary h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <strong>{{ f.strftime('%a %d/%m')|upper }}</strong>
            <span class="badge bg-info">{{ (plan.plan_type or 'descanso')|capitalize }}</span>
          </div>

          <div class="card-body">
            <form method="post" action="{{ url_for('main.coach_guardar_dia', user_id=atleta.id) }}">
              <input type="hidden" name="fecha" value="{{ f.isoformat() }}">
              <input type="hidden" name="center" value="{{ center.isoformat() }}">

              <div class="mb-2">
                <label class="form-label small text-muted mb-1">Tipo</label>
                <select name="plan_type" class="form-select form-select-sm">
                  {% set t = (plan.plan_type or 'descanso')|lower %}
                  <option value="descanso" {% if t=='descanso' %}selected{% endif %}>Descanso</option>
                  <option value="fuerza" {% if t=='fuerza' %}selected{% endif %}>Fuerza</option>
                  <option value="run" {% if t=='run' %}selected{% endif %}>Run</option>
                  <option value="pista" {% if t=='pista' %}selected{% endif %}>Pista</option>
                  <option value="bike" {% if t=='bike' %}selected{% endif %}>Bike</option>
                  <option value="natacion" {% if t=='natacion' %}selected{% endif %}>Nataci√≥n</option>
                </select>
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted mb-1">Calentamiento</label>
                <input name="warmup" class="form-control form-control-sm"
                       value="{{ plan.warmup or '' }}" placeholder="Ej: movilidad + skipping...">
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted mb-1">Rutina (si aplica)</label>
                <select name="rutina_id" class="form-select form-select-sm">
                  <option value="">‚Äî Sin rutina ‚Äî</option>
                  {% for r in rutinas %}
                    <option value="{{ r.id }}"
                      {% if plan.main and plan.main == ('RUTINA:' ~ r.id) %}selected{% endif %}>
                      {{ r.nombre }}{% if r.tipo %} ({{ r.tipo }}){% endif %}
                    </option>
                  {% endfor %}
                </select>
                <div class="form-text text-muted">
                  Esto guarda en el d√≠a: <code>RUTINA:ID</code>
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted mb-1">Finisher</label>
                <input name="finisher" class="form-control form-control-sm"
                       value="{{ plan.finisher or '' }}" placeholder="Ej: core 8'...">
              </div>

              <div class="row g-2 mb-3">
                <div class="col-6">
                  <label class="form-label small text-muted mb-1">Score propuesto</label>
                  <input type="number" name="propuesto_score" class="form-control form-control-sm"
                         value="{{ plan.propuesto_score or 0 }}">
                </div>
                <div class="col-6 d-flex align-items-end">
                  <button type="submit" class="btn btn-primary btn-sm w-100">
                    üíæ Guardar d√≠a
                  </button>
                </div>
              </div>

            </form>
          </div>

        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
