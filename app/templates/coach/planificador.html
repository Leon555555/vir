{% extends "layout.html" %}
{% block title %}Planificador ‚Äî {{ user.nombre }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-1">üìÖ Planificador ‚Äî {{ user.nombre }}</h3>
      <div class="text-muted">Semana: {{ semana_str }}</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('main.dashboard_entrenador') }}">‚Üê Volver</a>
      <a class="btn btn-outline-info btn-sm" href="{{ url_for('main.perfil_usuario', user_id=user.id) }}">Ver como atleta</a>
    </div>
  </div>

  <div class="row g-3">
    {% for f in fechas %}
      {% set plan = planes[f] %}
      {% set idx = loop.index %}
      {% set tipo = (plan.plan_type or 'descanso')|lower %}

      <div class="col-md-6 col-xl-3">
        <div class="card bg-dark border-secondary h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <strong>{{ f.strftime('%a')|upper }} {{ f.strftime('%d/%m') }}</strong>
            <span class="badge bg-info text-dark">{{ plan.plan_type|capitalize }}</span>
          </div>

          <div class="card-body">
            <form method="post" action="{{ url_for('main.coach_planificador_save', user_id=user.id) }}">
              <input type="hidden" name="fecha" value="{{ f.strftime('%Y-%m-%d') }}">
              <input type="hidden" name="center" value="{{ center.strftime('%Y-%m-%d') }}">

              <div class="mb-2">
                <label class="form-label small text-muted">Tipo</label>
                <select class="form-select form-select-sm" name="plan_type">
                  {% set tipos = ['descanso','fuerza','pista','run','bike','natacion','movilidad'] %}
                  {% for t in tipos %}
                    <option value="{{ t }}" {% if (plan.plan_type or 'descanso')|lower == t %}selected{% endif %}>
                      {{ t|capitalize }}
                    </option>
                  {% endfor %}
                </select>
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted">Rutina (opcional)</label>
                <select class="form-select form-select-sm" name="rutina_id">
                  <option value="">‚Äî Sin rutina ‚Äî</option>
                  {% for r in rutinas %}
                    <option value="{{ r.id }}" {% if plan.rutina_id == r.id %}selected{% endif %}>
                      {{ r.nombre }}{% if r.tipo %} ({{ r.tipo }}){% endif %}
                    </option>
                  {% endfor %}
                </select>
                <div class="form-text text-muted small">
                  Si asign√°s rutina, el atleta ver√° ejercicios + videos en el detalle del d√≠a.
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted">Warmup</label>
                <input class="form-control form-control-sm" name="warmup" value="{{ plan.warmup or '' }}">
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted">Main</label>
                <input class="form-control form-control-sm" name="main" value="{{ plan.main or '' }}">
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted">Finisher</label>
                <input class="form-control form-control-sm" name="finisher" value="{{ plan.finisher or '' }}">
              </div>

              <div class="row g-2">
                <div class="col-6">
                  <label class="form-label small text-muted">Dificultad</label>
                  <select class="form-select form-select-sm" name="dificultad">
                    <option value="" {% if not plan.dificultad %}selected{% endif %}>‚Äî</option>
                    <option value="facil" {% if plan.dificultad=='facil' %}selected{% endif %}>F√°cil</option>
                    <option value="media" {% if plan.dificultad=='media' %}selected{% endif %}>Media</option>
                    <option value="dura" {% if plan.dificultad=='dura' %}selected{% endif %}>Dura</option>
                  </select>
                </div>
                <div class="col-6">
                  <label class="form-label small text-muted">Puede entrenar</label>
                  <select class="form-select form-select-sm" name="puede_entrenar">
                    <option value="" {% if not plan.puede_entrenar %}selected{% endif %}>‚Äî</option>
                    <option value="si" {% if plan.puede_entrenar=='si' %}selected{% endif %}>S√≠</option>
                    <option value="no" {% if plan.puede_entrenar=='no' %}selected{% endif %}>No</option>
                  </select>
                </div>
              </div>

              <button class="btn btn-primary btn-sm w-100 mt-3" type="submit">Guardar d√≠a</button>
            </form>

          </div>
        </div>
      </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
