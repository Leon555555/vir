{# app/templates/components/modales.html #}

{% for f in fechas %}
  {% set plan = planes[f] %}
  {% set idx = loop.index %}

  <div class="modal fade" id="modal{{ idx }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content bg-dark text-light border-secondary">

        <div class="modal-header border-secondary">
          <h5 class="modal-title">
            {{ f.strftime('%A %d/%m')|capitalize }} ‚Äî {{ plan.plan_type|capitalize }}
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <div class="mb-3">
            <div class="small text-muted">Warmup</div>
            <div class="p-2 rounded bg-black">{{ plan.warmup or "‚Äî" }}</div>
          </div>

          <div class="mb-3">
            <div class="small text-muted">Main</div>
            <div class="p-2 rounded bg-black">{{ plan.main or "‚Äî" }}</div>
          </div>

          <div class="mb-3">
            <div class="small text-muted">Finisher</div>
            <div class="p-2 rounded bg-black">{{ plan.finisher or "‚Äî" }}</div>
          </div>

          {# =============================
             RUTINA ASIGNADA (si existe)
             ============================= #}
          {% if plan.rutina_id %}
            {% set rutina = plan.rutina %}
            <hr class="border-secondary">

            <h6 class="mb-2">üèãÔ∏è Rutina: {{ rutina.nombre }}</h6>

            <div class="row g-3">
              {% for item in rutina.items %}
                <div class="col-12">
                  <div class="card bg-black border-secondary">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-start">
                        <div>
                          <strong>{{ loop.index }}. {{ item.nombre }}</strong>
                          <div class="text-muted small">
                            {{ item.series or "‚Äî" }} series ¬∑ {{ item.reps or "‚Äî" }} reps ¬∑ {{ item.descanso or "‚Äî" }} descanso
                          </div>
                        </div>
                      </div>

                      {% if item.video_url %}
                        <video class="w-100 rounded mt-2" controls preload="metadata" style="max-height:240px;">
                          <source src="{{ url_for('static', filename=item.video_url) }}" type="video/mp4">
                        </video>
                      {% endif %}

                      {% if item.nota %}
                        <div class="mt-2 small text-info">üìù {{ item.nota }}</div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          <hr class="border-secondary">

          {# =============================
             ATLETA: marcar realizado
             ============================= #}
          <form method="post" action="{{ url_for('main.plan_marcar_realizado', plan_id=plan.id) }}">
            <div class="row g-2">
              <div class="col-md-3">
                <label class="form-label small text-muted">¬øRealizado?</label>
                <select class="form-select form-select-sm" name="realizado">
                  <option value="0" {% if not plan.realizado %}selected{% endif %}>No</option>
                  <option value="1" {% if plan.realizado %}selected{% endif %}>S√≠ ‚úÖ</option>
                </select>
              </div>

              <div class="col-md-3">
                <label class="form-label small text-muted">RPE (opcional)</label>
                <input class="form-control form-control-sm" type="number" min="1" max="10" name="rpe" value="{{ plan.rpe or '' }}">
              </div>

              <div class="col-md-6">
                <label class="form-label small text-muted">Comentario (opcional)</label>
                <input class="form-control form-control-sm" name="comentario_atleta" value="{{ plan.comentario_atleta or '' }}">
              </div>
            </div>

            <button class="btn btn-info btn-sm w-100 mt-3" type="submit">
              Guardar (Realizado / Comentario)
            </button>
          </form>

        </div>

      </div>
    </div>
  </div>
{% endfor %}
