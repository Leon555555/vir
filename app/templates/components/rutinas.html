{# ========================================== #}
{#  RUTINAS ULTRA PRO — VR TRAINING 2025      #}
{#  Programa por sesiones + listado antiguo   #}
{# ========================================== #}

<div class="rutina-container">

  <h4 class="text-info mb-3">
    <i class="bi bi-list-nested me-2"></i>Programa de entrenamiento
  </h4>

  {# ============================ #}
  {# PROGRAMA TIPO MYWELLNESS    #}
  {# ============================ #}
  {% if sesiones_programa is defined and sesiones_programa and sesiones_programa|length > 0 %}

    {% for sesion in sesiones_programa %}
    <div class="rutina-sesion mb-4">

      <!-- CABECERA SESIÓN -->
      <div class="sesion-header">
        <h5 class="sesion-titulo">Sesión {{ sesion.numero }}</h5>
      </div>

      <!-- GRID DE EJERCICIOS -->
      <div class="rutina-grid">

        {% for ej in sesion.ejercicios %}
        <div class="ej-card">

          <!-- IMAGEN EJERCICIO -->
          <div class="ej-img">
            <img
              src="{{ ej.imagen or url_for('static', filename='img/placeholder_exercise.png') }}"
              alt="{{ ej.nombre }}">
          </div>

          <!-- INFO EJERCICIO -->
          <div class="ej-info">
            <span class="ej-categoria">{{ ej.categoria or 'Actividad' }}</span>
            <h6 class="ej-nombre">{{ ej.nombre }}</h6>

            <div class="ej-detalles">
              {% if ej.series and ej.reps %}
                <div><strong>{{ ej.series }} x {{ ej.reps }}</strong>{% if ej.tiempo %} — {{ ej.tiempo }}{% endif %}</div>
              {% elif ej.tiempo %}
                <div>Duración: <strong>{{ ej.tiempo }}</strong></div>
              {% endif %}

              {% if ej.peso %}
                <div>Peso: <strong>{{ ej.peso }}</strong></div>
              {% endif %}

              {% if ej.nivel %}
                <div>Nivel: {{ ej.nivel }}</div>
              {% endif %}
            </div>
          </div>

          <!-- NÚMERO DE ORDEN -->
          <div class="ej-num">
            {{ "%02d"|format(loop.index) }}
          </div>
        </div>
        {% endfor %}

      </div>
    </div>
    {% endfor %}

  {% else %}
    <p class="text-secondary mb-4">
      Aún no se cargó un programa de entrenamiento para este atleta.
    </p>
  {% endif %}

  {# ======================================== #}
  {# BLOQUE ANTIGUO: RUTINAS DISPONIBLES     #}
  {# (solo admin, para drag&drop en el plan) #}
  {# ======================================== #}
  {% if current_user.email == "admin@vir.app" and rutinas %}
  <div class="card card-pro mt-4">
    <h5 class="text-info mb-3">
      <i class="bi bi-collection me-2"></i>Rutinas base disponibles
    </h5>

    <div class="d-flex flex-column gap-2">

      {% for r in rutinas %}
      <div class="p-3 bg-black border border-secondary rounded rutina-item"
           draggable="true"
           ondragstart="drag(event)"
           data-id="{{ r.id }}"
           data-tipo="{{ r.tipo }}"
           data-nombre="{{ r.nombre }}">
        <strong>{{ r.nombre }}</strong>
        <div class="text-secondary small">{{ r.tipo|capitalize }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

</div>
