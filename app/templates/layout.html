<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0,
                 viewport-fit=cover" />

  <title>{% block title %}VR Training{% endblock %}</title>

  <!-- ===================== -->
  <!-- ✅ PWA -->
  <!-- ===================== -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <meta name="theme-color" content="#000000">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="VR Training">
  <link rel="apple-touch-icon"
        href="{{ url_for('static', filename='icons/icon-192.png') }}">

  <!-- ===================== -->
  <!-- Bootstrap -->
  <!-- ===================== -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- VR TRAINING (siempre último) -->
  <link rel="stylesheet"
        href="{{ url_for('static', filename='css/styles_v2.css') }}?v=900">

  {% block extra_css %}{% endblock %}
</head>

<body class="vr-body">

  <nav class="navbar navbar-expand-lg vr-navbar fixed-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2"
         href="{{ url_for('main.index') }}">
        <img src="{{ url_for('static', filename='logo_blanco_vr_training.png') }}"
             alt="VR"
             style="height:28px;">
        <span class="vr-brand">VR TRAINING</span>
      </a>

      <div class="ms-auto d-flex gap-3 align-items-center">
        {% if current_user.is_authenticated %}
          {% if admin_ok %}
            <a class="vr-link" href="{{ url_for('main.dashboard_entrenador') }}">Panel</a>
            <a class="vr-link" href="{{ url_for('main.coach_planificador') }}">Planificador</a>
          {% else %}
            <a class="vr-link"
               href="{{ url_for('main.perfil_usuario', user_id=current_user.id) }}">
              Perfil
            </a>
          {% endif %}
          <a class="vr-link" href="{{ url_for('main.logout') }}">Salir</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <main class="vr-main">
    <div class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            <div class="alert alert-{{ cat }} vr-alert mb-3">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  {% block extra_js %}{% endblock %}

  <!-- ===================== -->
  <!-- ✅ Service Worker -->
  <!-- ===================== -->
  <script>
    (function () {
      if (!("serviceWorker" in navigator)) return;
      window.addEventListener("load", function () {
        navigator.serviceWorker.register(
          "{{ url_for('static', filename='service-worker.js') }}"
        );
      });
    })();
  </script>

</body>
</html>
