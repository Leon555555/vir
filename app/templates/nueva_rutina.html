{% extends "layout.html" %}
{% block title %}Nueva rutina{% endblock %}
{% block content %}
<style>
.card-vir{background:#0f1319;border:1px solid rgba(255,255,255,.06);border-radius:18px}
.fade-in{animation:fade .3s ease-out both}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.badge-soft{background:rgba(230,57,70,.15);border:1px solid rgba(230,57,70,.35);color:#ff6d77}
</style>

<div class="container mt-4">
  <h3 class="text-light mb-3">ðŸ’ª Crear nueva rutina</h3>

  <form action="{{ url_for('main.guardar_rutina') }}" method="POST" enctype="multipart/form-data" id="rutinaForm">
    <div class="card card-vir mb-4 p-3">
      <div class="mb-3">
        <label class="form-label text-light">Nombre</label>
        <input name="nombre" class="form-control bg-dark text-light" placeholder="Fuerza Full Body A" required>
      </div>
      <div class="mb-1">
        <label class="form-label text-light">DescripciÃ³n</label>
        <textarea name="descripcion" rows="2" class="form-control bg-dark text-light" placeholder="SesiÃ³n de fuerza general, 45â€“60 min"></textarea>
      </div>
    </div>

    <div id="itemsContainer"></div>

    <input type="hidden" name="total_items" id="total_items" value="0">

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-outline-light" id="addItem">âž• Agregar ejercicio</button>
      <button class="btn btn-danger">Guardar rutina</button>
      <a href="{{ url_for('main.listar_rutinas') }}" class="btn btn-secondary">Volver</a>
    </div>
  </form>
</div>

<script>
let idx = 0;
const container = document.getElementById('itemsContainer');
const total = document.getElementById('total_items');
document.getElementById('addItem').addEventListener('click', () => {
  const i = idx++;
  total.value = idx;

  const el = document.createElement('div');
  el.className = 'card card-vir mb-3 p-3 fade-in';
  el.innerHTML = `
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h6 class="text-light mb-0">Ejercicio #${i+1}</h6>
      <span class="badge badge-soft">media opcional</span>
    </div>
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label text-light">Nombre</label>
        <input name="items[${i}][nombre]" class="form-control bg-dark text-light" placeholder="Sentadilla goblet" required>
      </div>
      <div class="col-md-6">
        <label class="form-label text-light">Reps/Series</label>
        <input name="items[${i}][reps]" class="form-control bg-dark text-light" placeholder="4x10 @ RPE7">
      </div>

      <div class="col-md-6">
        <label class="form-label text-light">Video (URL YouTube / MP4)</label>
        <input name="items[${i}][video_url]" class="form-control bg-dark text-light" placeholder="https://youtu.be/...">
        <div class="form-text">o sube archivo MP4:</div>
        <input type="file" name="items[${i}][video_file]" accept="video/*" class="form-control bg-dark text-light">
      </div>

      <div class="col-md-6">
        <label class="form-label text-light">Imagen (URL)</label>
        <input name="items[${i}][imagen_url]" class="form-control bg-dark text-light" placeholder="https://...jpg">
        <div class="form-text">o sube archivo:</div>
        <input type="file" name="items[${i}][imagen_file]" accept="image/*" class="form-control bg-dark text-light">
      </div>

      <div class="col-12">
        <label class="form-label text-light">Nota</label>
        <textarea name="items[${i}][nota]" rows="2" class="form-control bg-dark text-light" placeholder="Indicaciones tÃ©cnicas, descansos, tempo..."></textarea>
      </div>
    </div>
  `;
  container.appendChild(el);
});
</script>
{% endblock %}
