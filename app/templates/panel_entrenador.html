{% extends "layout.html" %}
{% block title %}Panel del Entrenador â€” Admin{% endblock %}

{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="text-light mb-0">ğŸ‹ï¸ Panel Entrenador</h2>
      <div class="text-muted">Rutinas Â· Banco de ejercicios Â· Atletas</div>
    </div>
    <a class="btn btn-outline-info" href="{{ url_for('main.coach_planificador') }}">ğŸ—“ï¸ Ir al Planificador</a>
  </div>

  <div class="row g-4">
    <!-- Crear rutina -->
    <div class="col-lg-4">
      <div class="card p-3 box">
        <h5 class="text-info mb-3">â• Crear Rutina</h5>
        <form method="POST" action="{{ url_for('main.crear_rutina') }}">
          <input class="form-control mb-2" name="nombre" placeholder="Nombre de rutina" required>
          <input class="form-control mb-2" name="tipo" placeholder="Tipo (Fuerza / General / etc)">
          <textarea class="form-control mb-2" name="descripcion" placeholder="DescripciÃ³n (opcional)"></textarea>
          <button class="btn btn-info w-100" type="submit">Crear</button>
        </form>

        <hr style="border-color:rgba(255,255,255,.08)">

        <h6 class="text-light mb-2">ğŸ“š Rutinas</h6>
        <div class="list-group list-group-flush">
          {% for r in rutinas %}
            <div class="list-group-item item-row">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-bold text-light">{{ r.nombre }}</div>
                  <div class="small text-muted">{{ r.tipo or '' }}</div>
                </div>
                <a class="btn btn-sm btn-outline-light" href="{{ url_for('main.rutina_builder', rutina_id=r.id) }}">
                  Builder
                </a>
              </div>
            </div>
          {% else %}
            <div class="text-muted">No hay rutinas todavÃ­a.</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Subir ejercicio -->
    <div class="col-lg-4">
      <div class="card p-3 box">
        <h5 class="text-info mb-3">ğŸ“¤ Subir Ejercicio</h5>

        <form method="POST" action="{{ url_for('main.admin_nuevo_ejercicio') }}" enctype="multipart/form-data">
          <input class="form-control mb-2" name="nombre" placeholder="Nombre del ejercicio" required>
          <input class="form-control mb-2" name="categoria" placeholder="CategorÃ­a (pierna, tirÃ³n, empuje...)">
          <textarea class="form-control mb-2" name="descripcion" placeholder="DescripciÃ³n (opcional)"></textarea>
          <input class="form-control mb-2" type="file" name="video" accept="video/mp4" required>
          <button class="btn btn-info w-100" type="submit">Subir</button>
        </form>

        <hr style="border-color:rgba(255,255,255,.08)">

        <h6 class="text-light mb-2">ğŸ§© Banco</h6>
        <div class="list-group list-group-flush">
          {% for e in ejercicios[:8] %}
            <div class="list-group-item item-row">
              <div class="fw-bold text-light">{{ e.nombre }}</div>
              <div class="small text-muted">{{ e.categoria or '' }}</div>
              {% if e.video_filename %}
                <a class="small text-info" href="{{ url_for('static', filename='videos/' ~ e.video_filename) }}" target="_blank">
                  Ver video
                </a>
              {% endif %}
            </div>
          {% else %}
            <div class="text-muted">No hay ejercicios todavÃ­a.</div>
          {% endfor %}
        </div>

        {% if ejercicios|length > 8 %}
          <div class="small text-muted mt-2">Mostrando 8 de {{ ejercicios|length }} ejercicios.</div>
        {% endif %}
      </div>
    </div>

    <!-- Atletas -->
    <div class="col-lg-4">
      <div class="card p-3 box">
        <h5 class="text-info mb-3">ğŸ‘¥ Atletas</h5>
        <div class="small text-muted mb-2">PlanificÃ¡ desde Planificador o entrÃ¡ al perfil.</div>

        <div class="list-group list-group-flush">
          {% for a in atletas %}
            <div class="list-group-item item-row">
              <div class="d-flex justify-content-between align-items-center gap-2">
                <div>
                  <div class="fw-bold text-light">{{ a.nombre }}</div>
                  <div class="small text-muted">{{ a.email }}</div>
                </div>

                <div class="d-flex gap-2">
                  <a class="btn btn-sm btn-outline-info"
                     href="{{ url_for('main.coach_planificador', user_id=a.id) }}">Planificar</a>

                  <!-- âœ… ESTE ES EL BOTÃ“N QUE TE FALTA -->
                  <a class="btn btn-sm btn-outline-light"
                     href="{{ url_for('main.perfil_usuario', user_id=a.id) }}">Ver perfil</a>

                  <form method="POST" action="{{ url_for('main.admin_delete_user', user_id=a.id) }}"
                        onsubmit="return confirm('Â¿Eliminar atleta {{ a.nombre }}?');">
                    <button class="btn btn-sm btn-outline-danger" type="submit">Eliminar</button>
                  </form>
                </div>

              </div>
            </div>
          {% else %}
            <div class="text-muted">No hay atletas todavÃ­a.</div>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>
</div>

<style>
.box{
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 18px;
}
.item-row{
  background: rgba(0,0,0,.22);
  border: 1px solid rgba(255,255,255,.06);
  color:#fff;
}
.list-group-item{border-radius: 14px; margin-bottom:10px;}
</style>
{% endblock %}
