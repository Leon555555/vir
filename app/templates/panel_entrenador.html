{% extends "layout.html" %}
{% block title %}Panel entrenador{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <div class="section-title">PANEL ENTRENADOR</div>
    <div class="text-soft">Rutinas Â· Banco de ejercicios Â· Atletas</div>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-info" href="{{ url_for('main.coach_planificador') }}">
      <i class="bi bi-calendar3"></i> Planificador
    </a>
  </div>
</div>

<ul class="nav nav-pills mb-3" id="coachTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="tab-rutinas" data-bs-toggle="pill" data-bs-target="#pane-rutinas" type="button" role="tab">
      ðŸ§© Banco de Rutinas
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-ejercicios" data-bs-toggle="pill" data-bs-target="#pane-ejercicios" type="button" role="tab">
      ðŸŽ¥ Banco de Ejercicios
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-atletas" data-bs-toggle="pill" data-bs-target="#pane-atletas" type="button" role="tab">
      ðŸ‘¥ Atletas
    </button>
  </li>
</ul>

<div class="tab-content" id="coachTabsContent">

  <!-- =======================
       BANCO DE RUTINAS
  ======================== -->
  <div class="tab-pane fade show active" id="pane-rutinas" role="tabpanel">
    <div class="row g-3">

      <div class="col-lg-5">
        <div class="card glass lift">
          <div class="card-header"><strong>âž• Crear rutina</strong></div>
          <div class="card-body">
            <form method="post" action="{{ url_for('main.crear_rutina') }}">
              <div class="mb-2">
                <label class="form-label text-muted">Nombre</label>
                <input class="form-control" name="nombre" required>
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Tipo</label>
                <input class="form-control" name="tipo" placeholder="Fuerza / Tabata / Core / etc">
              </div>
              <div class="mb-3">
                <label class="form-label text-muted">DescripciÃ³n</label>
                <textarea class="form-control" name="descripcion" rows="3"></textarea>
              </div>
              <div class="d-grid">
                <button class="btn btn-info" type="submit">Crear rutina</button>
              </div>
            </form>

            <hr style="opacity:.15;">
            <div class="text-muted" style="font-size:.95rem;">
              âœ… Tip: armÃ¡s la rutina en <b>Builder</b>, y si querÃ©s TABATA le das preset en <b>Tabata Settings</b>.
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="card glass lift">
          <div class="card-header d-flex justify-content-between align-items-center">
            <strong>ðŸ“š Rutinas creadas</strong>
            <span class="text-muted" style="font-weight:900;">{{ rutinas|length }}</span>
          </div>
          <div class="card-body">
            {% if not rutinas %}
              <div class="text-muted">TodavÃ­a no hay rutinas.</div>
            {% else %}
              <div class="list-group">
                {% for r in rutinas %}
                  <div class="list-group-item glass" style="border-radius:14px; margin-bottom:10px;">
                    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                      <div>
                        <div style="font-weight:900;">#{{ r.id }} Â· {{ r.nombre }}</div>
                        <div class="text-muted">{{ r.tipo or '' }} â€” {{ r.descripcion or '' }}</div>
                      </div>
                      <div class="d-flex gap-2">
                        <a class="btn btn-sm btn-outline-info" href="{{ url_for('main.rutina_builder', rutina_id=r.id) }}">
                          Builder
                        </a>
                        <a class="btn btn-sm btn-outline-light" href="{{ url_for('main.rutina_tabata_player', rutina_id=r.id) }}">
                          Tabata
                        </a>
                        <a class="btn btn-sm btn-outline-warning" href="{{ url_for('main.rutina_tabata_settings', rutina_id=r.id) }}">
                          Settings
                        </a>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- =======================
       BANCO DE EJERCICIOS
  ======================== -->
  <div class="tab-pane fade" id="pane-ejercicios" role="tabpanel">
    <div class="row g-3">

      <div class="col-lg-6">
        <div class="card glass lift">
          <div class="card-header"><strong>âž• Crear ejercicio (banco)</strong></div>
          <div class="card-body">
            <form method="post" action="{{ url_for('main.admin_nuevo_ejercicio') }}" enctype="multipart/form-data">
              <div class="mb-2">
                <label class="form-label text-muted">Nombre</label>
                <input class="form-control" name="nombre" required>
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">CategorÃ­a</label>
                <input class="form-control" name="categoria" placeholder="Core, Pierna, Tren superior...">
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">DescripciÃ³n</label>
                <textarea class="form-control" name="descripcion" rows="2"></textarea>
              </div>

              <hr style="opacity:.15;">

              <div class="mb-2">
                <label class="form-label text-muted">Seleccionar video existente</label>
                <select class="form-select" name="video_existing">
                  <option value="">â€”</option>
                  {% for v in available_videos %}
                    <option value="{{ v }}">{{ v }}</option>
                  {% endfor %}
                </select>
                <div class="text-muted mt-1" style="font-size:.9rem;">
                  Recomendado en Render: commitear videos a <b>/static/videos</b>.
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label text-muted">o Subir video</label>
                <input class="form-control" type="file" name="video" accept="video/*">
              </div>

              <div class="d-grid">
                <button class="btn btn-info" type="submit">Crear ejercicio</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card glass lift">
          <div class="card-header d-flex justify-content-between align-items-center">
            <strong>ðŸŽ¥ Ejercicios en el banco</strong>
            <span class="text-muted" style="font-weight:900;">{{ ejercicios|length }}</span>
          </div>
          <div class="card-body">
            {% if not ejercicios %}
              <div class="text-muted">TodavÃ­a no hay ejercicios.</div>
            {% else %}
              <div class="list-group">
                {% for e in ejercicios %}
                  <div class="list-group-item glass" style="border-radius:14px; margin-bottom:10px;">
                    <div style="font-weight:900;">{{ e.nombre }}</div>
                    <div class="text-muted">{{ e.categoria or '' }} Â· {{ e.video_filename or '' }}</div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- =======================
       ATLETAS
  ======================== -->
  <div class="tab-pane fade" id="pane-atletas" role="tabpanel">
    <div class="row g-3">

      <div class="col-lg-6">
        <div class="card glass lift">
          <div class="card-header"><strong>âž• Crear atleta</strong></div>
          <div class="card-body">
            <form method="post" action="{{ url_for('main.admin_nuevo_atleta') }}">
              <div class="mb-2">
                <label class="form-label text-muted">Nombre</label>
                <input class="form-control" name="nombre" required>
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Email</label>
                <input class="form-control" name="email" required>
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Grupo</label>
                <input class="form-control" name="grupo">
              </div>
              <div class="mb-3">
                <label class="form-label text-muted">Password</label>
                <input class="form-control" name="password" required>
              </div>
              <div class="d-grid">
                <button class="btn btn-info" type="submit">Crear atleta</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card glass lift">
          <div class="card-header d-flex justify-content-between align-items-center">
            <strong>ðŸ‘¥ Atletas</strong>
            <span class="text-muted" style="font-weight:900;">{{ atletas|length }}</span>
          </div>
          <div class="card-body">
            {% if not atletas %}
              <div class="text-muted">No hay atletas.</div>
            {% else %}
              <div class="list-group">
                {% for a in atletas %}
                  <div class="list-group-item glass" style="border-radius:14px; margin-bottom:10px;">
                    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                      <div>
                        <div style="font-weight:900;">{{ a.nombre }}</div>
                        <div class="text-muted">{{ a.email }}</div>
                      </div>
                      <div class="d-flex gap-2">
                        <a class="btn btn-sm btn-outline-info"
                           href="{{ url_for('main.perfil_usuario', user_id=a.id, view='week') }}">
                          Ver perfil
                        </a>
                        <form method="post" action="{{ url_for('main.admin_delete_user', user_id=a.id) }}"
                              onsubmit="return confirm('Â¿Eliminar atleta?')">
                          <button class="btn btn-sm btn-outline-danger">Eliminar</button>
                        </form>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
{% endblock %}
