{% extends "layout.html" %}
{% block title %}Panel entrenador ‚Äî VR Training{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
  <div>
    <div class="section-title">PANEL ENTRENADOR</div>
    <div class="text-soft">Rutinas ¬∑ Banco de ejercicios ¬∑ Atletas</div>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-outline-info" href="{{ url_for('main.coach_planificador') }}">
      <i class="bi bi-calendar3"></i> Planificador
    </a>
    <a class="btn btn-outline-light" href="#tab-rutinas" onclick="document.getElementById('nav-rutinas').click()">
      <i class="bi bi-journal-text"></i> Rutinas
    </a>
  </div>
</div>

<!-- NAV TABS -->
<ul class="nav nav-pills mb-3 gap-2" id="coachTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="nav-rutinas" data-bs-toggle="pill" data-bs-target="#tab-rutinas" type="button" role="tab">
      üìö Rutinas
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-ejercicios" type="button" role="tab">
      üèãÔ∏è Ejercicios
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-atletas" type="button" role="tab">
      üßë‚Äçü§ù‚Äçüßë Atletas
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-videos" type="button" role="tab">
      üé• Videos
    </button>
  </li>
</ul>

<div class="tab-content">

  <!-- =======================
       TAB RUTINAS
  ======================== -->
  <div class="tab-pane fade show active" id="tab-rutinas" role="tabpanel">
    <div class="row g-3">

      <!-- Crear rutina -->
      <div class="col-lg-5">
        <div class="card glass lift">
          <div class="card-header"><strong>‚ûï Crear rutina</strong></div>
          <div class="card-body">
            <form method="post" action="{{ url_for('main.crear_rutina') }}">
              <div class="mb-2">
                <label class="form-label text-muted">Nombre</label>
                <input class="form-control" name="nombre" required>
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Tipo</label>
                <input class="form-control" name="tipo" placeholder="Fuerza / Tabata / Run...">
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Descripci√≥n</label>
                <textarea class="form-control" name="descripcion" rows="2"></textarea>
              </div>
              <button class="btn btn-info w-100" type="submit">Crear rutina</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Banco rutinas -->
      <div class="col-lg-7">
        <div class="card glass lift">
          <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
            <strong>üìö Banco de rutinas</strong>
            <span class="text-muted" style="font-size:.9rem;">Total: {{ rutinas|length if rutinas is defined else 0 }}</span>
          </div>
          <div class="card-body">
            {% set rr = rutinas if rutinas is defined else (rutinas_creadas if rutinas_creadas is defined else banco_rutinas) %}
            {% if rr and rr|length %}
              <div class="table-responsive">
                <table class="table table-dark table-hover align-middle">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Nombre</th>
                      <th>Tipo</th>
                      <th style="width:320px;">Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for r in rr %}
                    <tr>
                      <td class="text-muted">{{ r.id }}</td>
                      <td class="fw-bold">{{ r.nombre }}</td>
                      <td class="text-muted">{{ r.tipo or "‚Äî" }}</td>
                      <td class="d-flex gap-2 flex-wrap">
                        <a class="btn btn-sm btn-outline-info" href="{{ url_for('main.rutina_builder', rutina_id=r.id) }}">
                          üß± Builder
                        </a>
                        <a class="btn btn-sm btn-outline-warning" href="{{ url_for('main.rutina_tabata_settings', rutina_id=r.id) }}">
                          ‚è±Ô∏è Tabata
                        </a>
                        <a class="btn btn-sm btn-outline-light" href="{{ url_for('main.rutina_tabata_player', rutina_id=r.id) }}">
                          ‚ñ∂ Player
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-muted">Todav√≠a no hay rutinas creadas.</div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- =======================
       TAB EJERCICIOS
  ======================== -->
  <div class="tab-pane fade" id="tab-ejercicios" role="tabpanel">
    <div class="row g-3">
      <div class="col-lg-5">
        <div class="card glass lift">
          <div class="card-header"><strong>‚ûï Crear ejercicio</strong></div>
          <div class="card-body">
            <form method="post" action="{{ url_for('main.admin_nuevo_ejercicio') }}" enctype="multipart/form-data">
              <div class="mb-2">
                <label class="form-label text-muted">Nombre</label>
                <input class="form-control" name="nombre" required>
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Categor√≠a</label>
                <input class="form-control" name="categoria" placeholder="Piernas / Core / Empuje...">
              </div>
              <div class="mb-2">
                <label class="form-label text-muted">Descripci√≥n</label>
                <textarea class="form-control" name="descripcion" rows="2"></textarea>
              </div>

              <div class="mb-2">
                <label class="form-label text-muted">Video existente (recomendado)</label>
                <select class="form-select" name="video_existing">
                  <option value="">‚Äî Seleccionar ‚Äî</option>
                  {% for v in available_videos %}
                    <option value="{{ v }}">{{ v }}</option>
                  {% endfor %}
                </select>
                <div class="text-muted mt-1" style="font-size:.85rem;">
                  En Render conviene seleccionar videos del repo (persistentes).
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label text-muted">O subir video</label>
                <input class="form-control" type="file" name="video" accept=".mp4,.mov,.webm,.m4v">
              </div>

              <button class="btn btn-outline-info w-100" type="submit">Crear ejercicio</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="card glass lift">
          <div class="card-header"><strong>üèãÔ∏è Banco de ejercicios</strong></div>
          <div class="card-body">
            {% if ejercicios and ejercicios|length %}
              <div class="table-responsive">
                <table class="table table-dark table-hover align-middle">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Nombre</th>
                      <th class="d-none d-md-table-cell">Categor√≠a</th>
                      <th>Video</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for e in ejercicios %}
                    <tr>
                      <td class="text-muted">{{ e.id }}</td>
                      <td class="fw-bold">{{ e.nombre }}</td>
                      <td class="text-muted d-none d-md-table-cell">{{ e.categoria or "‚Äî" }}</td>
                      <td class="text-muted">{{ e.video_filename or "‚Äî" }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-muted">Todav√≠a no hay ejercicios.</div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- =======================
       TAB ATLETAS
  ======================== -->
  <div class="tab-pane fade" id="tab-atletas" role="tabpanel">
    <div class="row g-3">
      <div class="col-lg-5">
        <div class="card glass lift">
          <div class="card-header"><strong>‚ûï Crear atleta</strong></div>
          <div class="card-body">
            <form method="post" action="{{ url_for('main.admin_nuevo_atleta') }}">
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label text-muted">Nombre</label>
                  <input class="form-control" name="nombre" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label text-muted">Grupo</label>
                  <input class="form-control" name="grupo" placeholder="A / B / Elite...">
                </div>
              </div>
              <div class="row g-2 mt-1">
                <div class="col-md-6">
                  <label class="form-label text-muted">Email</label>
                  <input class="form-control" name="email" type="email" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label text-muted">Password</label>
                  <input class="form-control" name="password" type="text" required>
                </div>
              </div>
              <button class="btn btn-outline-info w-100 mt-3" type="submit">Crear atleta</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="card glass lift">
          <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
            <strong>üßë‚Äçü§ù‚Äçüßë Atletas</strong>
            <a class="btn btn-sm btn-outline-info" href="{{ url_for('main.coach_planificador') }}">
              <i class="bi bi-calendar3"></i> Planificar
            </a>
          </div>
          <div class="card-body">
            {% if atletas and atletas|length %}
              <div class="table-responsive">
                <table class="table table-dark table-hover align-middle">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Nombre</th>
                      <th>Email</th>
                      <th style="width:120px;">Acci√≥n</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for a in atletas %}
                    <tr>
                      <td class="text-muted">{{ a.id }}</td>
                      <td class="fw-bold">{{ a.nombre }}</td>
                      <td class="text-muted">{{ a.email }}</td>
                      <td>
                        <a class="btn btn-sm btn-outline-info"
                           href="{{ url_for('main.coach_planificador', user_id=a.id) }}">
                          Planificar
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-muted">No hay atletas.</div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- =======================
       TAB VIDEOS
  ======================== -->
  <div class="tab-pane fade" id="tab-videos" role="tabpanel">
    <div class="card glass lift">
      <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
        <strong>üé• Videos disponibles</strong>
        <span class="text-muted" style="font-size:.9rem;">Repo: /static/videos</span>
      </div>
      <div class="card-body">
        {% if available_videos and available_videos|length %}
          <div class="table-responsive">
            <table class="table table-dark table-hover align-middle">
              <thead>
                <tr>
                  <th>Archivo</th>
                  <th style="width:140px;">Acci√≥n</th>
                </tr>
              </thead>
              <tbody>
                {% for v in available_videos %}
                <tr>
                  <td class="text-muted">{{ v }}</td>
                  <td>
                    <form method="post" action="{{ url_for('main.admin_delete_video') }}" style="display:inline;">
                      <input type="hidden" name="filename" value="{{ v }}">
                      <button class="btn btn-sm btn-outline-danger" type="submit">Eliminar</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">No hay videos en el repo.</div>
        {% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}
