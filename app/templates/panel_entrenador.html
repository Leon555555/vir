{% extends "layout.html" %}
{% block title %}Dashboard Entrenador â€” VR Training{% endblock %}

{% block content %}
<div class="container mt-3">

  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
    <div>
      <h3 class="text-light mb-0">Dashboard Entrenador</h3>
      <div class="text-muted">GestionÃ¡ atletas, rutinas y banco de ejercicios.</div>
    </div>

    <div class="d-flex gap-2 flex-wrap">
      <a class="btn btn-info" href="{{ url_for('main.admin_nuevo_atleta') }}">âž• Crear atleta</a>
      <a class="btn btn-outline-info" href="{{ url_for('main.coach_planificador') }}">ðŸ“… Planificador</a>
    </div>
  </div>

  <div class="row g-3">
    <!-- ATLETAS -->
    <div class="col-lg-6">
      <div class="card glass p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-bold">Atletas</div>
          <span class="badge bg-secondary">{{ atletas|length }}</span>
        </div>

        {% if atletas %}
          <div class="table-responsive">
            <table class="table table-dark table-bordered align-middle mb-0">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>Grupo</th>
                  <th style="width:180px;">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for a in atletas %}
                <tr>
                  <td class="fw-bold">{{ a.nombre }}</td>
                  <td class="text-muted">{{ a.email }}</td>
                  <td>{{ a.grupo or "â€”" }}</td>
                  <td class="d-flex gap-2">
                    <a class="btn btn-sm btn-outline-info"
                       href="{{ url_for('main.perfil_atleta', user_id=a.id, view='today') }}">
                      Ver perfil
                    </a>
                    <form method="POST" action="{{ url_for('main.admin_delete_user', user_id=a.id) }}"
                          onsubmit="return confirm('Â¿Eliminar atleta y todo su historial?');">
                      <button class="btn btn-sm btn-outline-danger" type="submit">Eliminar</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">TodavÃ­a no tenÃ©s atletas creados.</div>
        {% endif %}
      </div>
    </div>

    <!-- RUTINAS -->
    <div class="col-lg-6">
      <div class="card glass p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-bold">Rutinas</div>
          <span class="badge bg-secondary">{{ rutinas|length }}</span>
        </div>

        <form method="POST" action="{{ url_for('main.crear_rutina') }}" class="row g-2 mb-3">
          <div class="col-md-6">
            <input class="form-control" name="nombre" placeholder="Nombre rutina (ej: Pierna A)" required>
          </div>
          <div class="col-md-3">
            <input class="form-control" name="tipo" placeholder="Tipo (Fuerza)">
          </div>
          <div class="col-md-12">
            <input class="form-control" name="descripcion" placeholder="DescripciÃ³n (opcional)">
          </div>
          <div class="col-md-12">
            <button class="btn btn-primary w-100" type="submit">âœ… Crear rutina</button>
          </div>
        </form>

        {% if rutinas %}
          <div class="d-flex flex-column gap-2">
            {% for r in rutinas %}
              <div class="glass p-3" style="border-radius:16px;">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                  <div>
                    <div class="fw-bold">{{ r.nombre }}</div>
                    <div class="text-muted" style="font-size:.92rem;">{{ r.descripcion or "â€”" }}</div>
                  </div>
                  <a class="btn btn-sm btn-outline-info" href="{{ url_for('main.rutina_builder', rutina_id=r.id) }}">
                    ðŸ§± Builder
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-muted">TodavÃ­a no creaste rutinas.</div>
        {% endif %}
      </div>
    </div>

    <!-- EJERCICIOS -->
    <div class="col-12">
      <div class="card glass p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-bold">Banco de ejercicios</div>
          <span class="badge bg-secondary">{{ ejercicios|length }}</span>
        </div>

        <form method="POST" action="{{ url_for('main.admin_nuevo_ejercicio') }}" enctype="multipart/form-data" class="row g-2">
          <div class="col-md-4">
            <input class="form-control" name="nombre" placeholder="Nombre ejercicio" required>
          </div>
          <div class="col-md-3">
            <input class="form-control" name="categoria" placeholder="CategorÃ­a (Pierna / Empuje...)">
          </div>
          <div class="col-md-3">
            <input class="form-control" type="file" name="video" accept="video/mp4,video/*" required>
          </div>
          <div class="col-md-2">
            <button class="btn btn-info w-100" type="submit">â¬† Subir</button>
          </div>
          <div class="col-12">
            <input class="form-control" name="descripcion" placeholder="DescripciÃ³n (opcional)">
          </div>
        </form>

        <hr class="my-3">

        {% if ejercicios %}
          <div class="row g-2">
            {% for e in ejercicios[:12] %}
              <div class="col-md-4 col-lg-3">
                <div class="glass p-3" style="border-radius:16px;">
                  <div class="fw-bold">{{ e.nombre }}</div>
                  <div class="text-muted" style="font-size:.9rem;">{{ e.categoria or "â€”" }}</div>
                </div>
              </div>
            {% endfor %}
          </div>
          {% if ejercicios|length > 12 %}
            <div class="text-muted mt-2">Mostrando 12 de {{ ejercicios|length }} (para no cargar de mÃ¡s el panel).</div>
          {% endif %}
        {% else %}
          <div class="text-muted">TodavÃ­a no subiste ejercicios.</div>
        {% endif %}
      </div>
    </div>

  </div>

</div>
{% endblock %}
