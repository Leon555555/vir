{% extends "layout.html" %}
{% block title %}Perfil de {{ user.nombre }}{% endblock %}

{% block content %}
<!-- ======================================== -->
<!-- DASHBOARD PRO: PERFIL DE ATLETA -->
<!-- ======================================== -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  body {
    background-color: #0b0b0b;
    color: #fff;
    font-family: "Poppins", sans-serif;
  }

  .perfil-header {
    background: linear-gradient(135deg, #1b1b1b, #222);
    border-radius: 15px;
    padding: 30px;
    margin-top: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
  }

  .perfil-header h2 {
    color: #e63946;
    font-size: 1.8rem;
    font-weight: 700;
  }

  .calendar-section {
    background-color: #161616;
    border-radius: 12px;
    padding: 25px;
    margin-top: 35px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
  }

  .chart-section {
    background-color: #181818;
    border-radius: 12px;
    padding: 25px;
    margin-top: 35px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
  }

  .training-section {
    background-color: #191919;
    border-radius: 12px;
    padding: 25px;
    margin-top: 35px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
  }

  .training-card {
    background-color: #222;
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 10px;
  }

  .training-card h6 {
    color: #f5b000;
    margin-bottom: 5px;
  }

  .training-card small {
    color: #bbb;
  }

  .btn-toggle {
    background-color: #e63946;
    border: none;
    border-radius: 6px;
    padding: 6px 10px;
    color: #fff;
    cursor: pointer;
    font-size: 0.9rem;
  }

  .btn-toggle:hover {
    background-color: #d62828;
  }
</style>

<div class="container">
  <!-- CABECERA -->
  <div class="perfil-header">
    <div>
      <h2>🏃‍♂️ {{ user.nombre }}</h2>
      <p class="text-muted">{{ user.email }}</p>
      <p><strong>Grupo:</strong> {{ user.grupo or "—" }}</p>
    </div>
    <div style="font-size: 60px;">💪</div>
  </div>

  <!-- CALENDARIO INTERACTIVO -->
  <div class="calendar-section">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>📅 Calendario de Entrenamientos</h4>
      <button id="toggleView" class="btn-toggle">+ Ver mes</button>
    </div>
    <div id="calendar"></div>
  </div>

  <!-- GRÁFICO DE PROGRESO -->
  <div class="chart-section">
    <h4>📈 Evolución Semanal</h4>
    <canvas id="progressChart" height="100"></canvas>
  </div>

  <!-- SESIONES DE ENTRENAMIENTO -->
  <div class="training-section">
    <h4>🏋️ Sesiones de fuerza propuestas</h4>

    <div class="training-card">
      <h6>Press de banca</h6>
      <small>4x10 reps · 60 kg · Ritmo controlado</small>
    </div>

    <div class="training-card">
      <h6>Sentadillas</h6>
      <small>4x8 reps · 80 kg · Profundas</small>
    </div>

    <div class="training-card">
      <h6>Peso muerto</h6>
      <small>3x6 reps · 90 kg · Técnica estricta</small>
    </div>
  </div>
</div>

<script>
  // ===========================
  // CALENDARIO FULLCALENDAR
  // ===========================
  document.addEventListener("DOMContentLoaded", function () {
    const calendarEl = document.getElementById("calendar");
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "timeGridWeek",
      height: 500,
      headerToolbar: false,
      events: [
        { title: "Fuerza Tren Superior", start: "2025-10-27T09:00:00" },
        { title: "Carrera Tempo", start: "2025-10-28T18:00:00" },
        { title: "Descanso Activo", start: "2025-10-29T11:00:00" },
        { title: "Fuerza Piernas", start: "2025-10-30T09:30:00" },
      ],
    });
    calendar.render();

    const toggleBtn = document.getElementById("toggleView");
    let monthly = false;

    toggleBtn.addEventListener("click", () => {
      monthly = !monthly;
      calendar.changeView(monthly ? "dayGridMonth" : "timeGridWeek");
      toggleBtn.textContent = monthly ? "↩ Ver semana" : "+ Ver mes";
    });
  });

  // ===========================
  // CHART.JS - GRÁFICO DE PROGRESO
  // ===========================
  const ctx = document.getElementById("progressChart");
  new Chart(ctx, {
    type: "line",
    data: {
      labels: ["Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
      datasets: [
        {
          label: "Cumplimiento %",
          data: [80, 85, 90, 88, 92, 96, 97],
          borderColor: "#e63946",
          backgroundColor: "rgba(230, 57, 70, 0.3)",
          tension: 0.3,
          fill: true,
        },
      ],
    },
    options: {
      scales: {
        y: { min: 0, max: 100, ticks: { color: "#ccc" } },
        x: { ticks: { color: "#ccc" } },
      },
      plugins: { legend: { display: false } },
    },
  });
</script>
{% endblock %}
