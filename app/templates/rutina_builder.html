{% extends "layout.html" %}
{% block title %}Editar rutina{% endblock %}

{% block content %}
<div class="container-fluid builder-page mt-4 mb-5">

  <div class="text-center mb-4">
    <h1 class="builder-title">Editar rutina</h1>
    <p class="text-muted">
      Rutina: <strong>{{ rutina.nombre }}</strong>
      {% if rutina.tipo %} <span>({{ rutina.tipo }})</span>{% endif %}
    </p>
  </div>

  <div class="row">
    <!-- ================= IZQUIERDA: EJERCICIOS DE LA RUTINA ================= -->
    <div class="col-lg-6 mb-4">
      <div class="card h-100 builder-panel">
        <div class="card-header">
          <h3 class="mb-0">üèãÔ∏è‚Äç‚ôÇÔ∏è Ejercicios de la rutina</h3>
        </div>
        <div class="card-body builder-panel-body">

          {% if items %}
            {% for item in items %}
              <div class="card mb-4 rutina-item-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <div>
                    <span class="text-muted me-2">{{ loop.index }}.</span>
                    <strong>{{ item.nombre }}</strong>
                  </div>

                  <form method="post"
                        action="{{ url_for('main.rutina_delete_item',
                                           rutina_id=rutina.id,
                                           item_id=item.id) }}">
                    <button type="submit"
                            class="btn btn-sm btn-outline-danger">
                      üóë Eliminar
                    </button>
                  </form>
                </div>

                <div class="card-body">
                  <div class="mb-3">
                    <video class="w-100" controls preload="metadata">
                      <source src="{{ url_for('static', filename=item.video_url) }}" type="video/mp4">
                      Tu navegador no soporta v√≠deo.
                    </video>
                  </div>

                  <form method="post"
                        action="{{ url_for('main.rutina_update_item',
                                           rutina_id=rutina.id,
                                           item_id=item.id) }}">
                    <div class="row mb-3">
                      <div class="col-4 mb-2">
                        <label class="form-label mb-1">Series</label>
                        <input type="text"
                               name="series"
                               class="form-control"
                               value="{{ item.series or '' }}"
                               placeholder="3">
                      </div>
                      <div class="col-4 mb-2">
                        <label class="form-label mb-1">Reps</label>
                        <input type="text"
                               name="reps"
                               class="form-control"
                               value="{{ item.reps or '' }}"
                               placeholder="12">
                      </div>
                      <div class="col-4 mb-2">
                        <label class="form-label mb-1">Descanso</label>
                        <input type="text"
                               name="descanso"
                               class="form-control"
                               value="{{ item.descanso or '' }}"
                               placeholder="1' entre serie">
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label mb-1">
                        Notas (tempo, t√©cnica, RPE, indicaciones‚Ä¶)
                      </label>
                      <textarea name="nota"
                                class="form-control"
                                rows="2"
                                placeholder="Vigila las lumbares">{{ item.nota or '' }}</textarea>
                    </div>

                    <div class="d-grid">
                      <button type="submit" class="btn btn-primary">
                        üíæ Guardar cambios
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted">Todav√≠a no hay ejercicios en esta rutina.</p>
          {% endif %}

        </div>
      </div>
    </div>

    <!-- ================= DERECHA: BANCO DE EJERCICIOS ================= -->
    <div class="col-lg-6 mb-4">
      <div class="card h-100 builder-panel">
        <div class="card-header">
          <h3 class="mb-0">üìö Banco de ejercicios</h3>
        </div>
        <div class="card-body builder-panel-body">

          {% if ejercicios %}
            {% for ej in ejercicios %}
              <div class="card mb-4 banco-ej-card">
                <div class="card-header">
                  <div class="d-flex justify-content-between align-items-center">
                    <strong>{{ ej.nombre }}</strong>
                    {% if ej.categoria %}
                      <span class="badge bg-secondary">{{ ej.categoria }}</span>
                    {% endif %}
                  </div>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <video class="w-100" controls preload="metadata">
                      <source src="{{ url_for('static',
                                              filename='videos_ejercicios/' ~ ej.video_filename) }}"
                              type="video/mp4">
                      Tu navegador no soporta v√≠deo.
                    </video>
                  </div>

                  <form method="post"
                        action="{{ url_for('main.rutina_add_item', rutina_id=rutina.id) }}">
                    <input type="hidden" name="ejercicio_id" value="{{ ej.id }}">

                    <div class="row mb-3">
                      <div class="col-4 mb-2">
                        <input type="text"
                               name="series"
                               class="form-control"
                               placeholder="Series">
                      </div>
                      <div class="col-4 mb-2">
                        <input type="text"
                               name="reps"
                               class="form-control"
                               placeholder="Reps">
                      </div>
                      <div class="col-4 mb-2">
                        <input type="text"
                               name="descanso"
                               class="form-control"
                               placeholder="Descanso">
                      </div>
                    </div>

                    <div class="mb-3">
                      <textarea name="nota"
                                class="form-control"
                                rows="2"
                                placeholder="Notas (opcional)"></textarea>
                    </div>

                    <div class="d-grid">
                      <button type="submit" class="btn btn-outline-info">
                        ‚ûï A√±adir a rutina
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted">
              Todav√≠a no hay ejercicios en el banco. Crea alguno desde el dashboard.
            </p>
          {% endif %}

        </div>
      </div>
    </div>
  </div>

  <!-- ================= BOT√ìN GLOBAL: GUARDAR Y VOLVER ================= -->
  <div class="row mt-3">
    <div class="col-12">
      <form method="post"
            action="{{ url_for('main.rutina_finish', rutina_id=rutina.id) }}"
            class="text-center">
        <button type="submit" class="btn btn-success btn-lg px-5">
          ‚úÖ Guardar cambios y volver al panel
        </button>
      </form>
    </div>
  </div>

</div>
{% endblock %}
