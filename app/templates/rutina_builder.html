{% extends "layout.html" %}
{% block title %}Editar rutina{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div>
      <h2 class="text-strong mb-0">Editar rutina</h2>
      <div class="text-soft">Rutina: <strong class="text-strong">{{ rutina.nombre }}</strong> {% if rutina.tipo %}({{ rutina.tipo }}){% endif %}</div>
    </div>
    <a class="btn btn-outline-info" href="{{ url_for('main.dashboard_entrenador') }}">‚Üê Volver</a>
  </div>

  <div class="row g-4">
    <!-- IZQ -->
    <div class="col-lg-6">
      <div class="card glass p-3">
        <h5 class="section-title">üìå Ejercicios de la rutina</h5>

        {% if items %}
          {% for item in items %}
            <div class="item-row mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <strong class="text-strong">{{ loop.index }}. {{ item.nombre }}</strong>
                <form method="post"
                      action="{{ url_for('main.rutina_delete_item', rutina_id=rutina.id, item_id=item.id) }}"
                      onsubmit="return confirm('¬øEliminar {{ item.nombre }} de la rutina?');">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Eliminar</button>
                </form>
              </div>

              {% if item.video_url %}
                <video class="w-100 mb-2" controls preload="metadata" style="max-height: 320px;">
                  <source src="{{ url_for('static', filename=item.video_url) }}" type="video/mp4">
                </video>
              {% endif %}

              <form method="post"
                    action="{{ url_for('main.rutina_update_item', rutina_id=rutina.id, item_id=item.id) }}"
                    class="row g-2">

                <div class="col-md-4">
                  <label class="form-label form-label-sm">Series</label>
                  <input type="text" name="series" value="{{ item.series or '' }}" class="form-control form-control-sm">
                </div>
                <div class="col-md-4">
                  <label class="form-label form-label-sm">Reps</label>
                  <input type="text" name="reps" value="{{ item.reps or '' }}" class="form-control form-control-sm">
                </div>
                <div class="col-md-4">
                  <label class="form-label form-label-sm">Descanso</label>
                  <input type="text" name="descanso" value="{{ item.descanso or '' }}" class="form-control form-control-sm">
                </div>

                <div class="col-12">
                  <label class="form-label form-label-sm">Nota</label>
                  <textarea name="nota" rows="2" class="form-control form-control-sm">{{ item.nota or '' }}</textarea>
                </div>

                <div class="col-12 d-grid mt-2">
                  <button type="submit" class="btn btn-sm btn-primary">Guardar cambios</button>
                </div>
              </form>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-soft">Esta rutina todav√≠a no tiene ejercicios.</div>
        {% endif %}
      </div>
    </div>

    <!-- DER -->
    <div class="col-lg-6">
      <div class="card glass p-3">
        <h5 class="section-title">üß± Banco de ejercicios</h5>

        {% if ejercicios %}
          {% for ej in ejercicios %}
            <div class="item-row mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <strong class="text-strong">{{ ej.nombre }}</strong>
                {% if ej.categoria %}<span class="badge bg-info">{{ ej.categoria }}</span>{% endif %}
              </div>

              {% if ej.video_filename %}
                <video class="w-100 mb-2" controls preload="metadata" style="max-height: 240px;">
                  <source src="{{ url_for('static', filename='videos/' ~ ej.video_filename) }}" type="video/mp4">
                </video>
              {% endif %}

              <form method="post" action="{{ url_for('main.rutina_add_item', rutina_id=rutina.id) }}" class="row g-2">
                <input type="hidden" name="ejercicio_id" value="{{ ej.id }}">

                <div class="col-md-4">
                  <input type="text" name="series" placeholder="Series" class="form-control form-control-sm">
                </div>
                <div class="col-md-4">
                  <input type="text" name="reps" placeholder="Reps" class="form-control form-control-sm">
                </div>
                <div class="col-md-4">
                  <input type="text" name="descanso" placeholder="Descanso" class="form-control form-control-sm">
                </div>

                <div class="col-12">
                  <textarea name="nota" rows="2" placeholder="Nota (opcional)" class="form-control form-control-sm"></textarea>
                </div>

                <div class="col-12 d-grid mt-2">
                  <button type="submit" class="btn btn-sm btn-outline-info">+ A√±adir a rutina</button>
                </div>
              </form>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-soft">No hay ejercicios en el banco todav√≠a.</div>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
